# Douyin Media Extractor (æŠ–éŸ³åª’ä½“æå–å™¨)

`douyin_phaser.py` æ˜¯ä¸€ä¸ªåŸºäº Playwright æµè§ˆå™¨è‡ªåŠ¨åŒ–çš„æŠ–éŸ³åª’ä½“ç›´é“¾æå–å·¥å…·ã€‚æ”¯æŒæå–ï¼š **è§†é¢‘ (4K)**ã€**å›¾é›†** å’Œ **åŠ¨å›¾** çš„ç›´é“¾æå–ã€‚æä¾›å‘½ä»¤è¡Œå·¥å…· (CLI) å’Œ HTTP API ä¸¤ç§ä½¿ç”¨æ–¹å¼ã€‚

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

- **å…¨ç±»å‹æ”¯æŒ**: è§†é¢‘ (`/video/`)ã€å›¾æ–‡ (`/note/`)ã€åŠ¨å›¾ (`/note/` + GIF)
- **æœ€é«˜ç”»è´¨**: è‡ªåŠ¨é€‰æ‹© 4K/2K/1080p æœ€é«˜æ¸…æ™°åº¦
- **API æœåŠ¡**: å†…ç½® FastAPI æœåŠ¡å™¨ï¼Œæ–¹ä¾¿é›†æˆåˆ°å…¶ä»–ç³»ç»Ÿ
- **åçˆ¬è™«ç»•è¿‡**: åŸºäº Playwright æ¨¡æ‹ŸçœŸå®æµè§ˆå™¨ï¼Œè‡ªåŠ¨å¤„ç†ç­¾åå’ŒéªŒè¯

## âš ï¸ å…è´£å£°æ˜

1. æœ¬é¡¹ç›®ä»…ä¾›æŠ€æœ¯ç ”ç©¶å’Œå­¦ä¹ äº¤æµä½¿ç”¨ï¼Œè¯·å‹¿ç”¨äºéæ³•ç”¨é€”ã€‚
2. ç”¨æˆ·åœ¨ä½¿ç”¨æœ¬å·¥å…·æ—¶ï¼Œå¿…é¡»éµå®ˆå½“åœ°æ³•å¾‹æ³•è§„ã€‚å¯¹äºç”¨æˆ·å› éæ³•ä½¿ç”¨è€Œäº§ç”Ÿçš„ä»»ä½•æ³•å¾‹çº çº·ï¼Œä½œè€…ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚
3. æœ¬å·¥å…·ä»…æä¾›è§£æåŠŸèƒ½ï¼Œä¸å­˜å‚¨ä»»ä½•è§†é¢‘èµ„æºã€‚æ‰€æœ‰è§†é¢‘ç‰ˆæƒå½’åŸå¹³å°åŠä½œè€…æ‰€æœ‰ã€‚
4. å¦‚æœåŸå¹³å°è®¤ä¸ºæœ¬é¡¹ç›®ä¾µçŠ¯äº†æ‚¨çš„æƒç›Šï¼Œè¯·è”ç³»æˆ‘ï¼Œæˆ‘ä¼šç«‹å³å¤„ç†ã€‚ ğŸ“§


## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šDocker å¿«é€Ÿéƒ¨ç½² (ä»…åª’ä½“æå–)

å¦‚æœä½ åªéœ€è¦æå–**å•ä¸ªè§†é¢‘/å›¾æ–‡**çš„ç›´é“¾ï¼Œæ— éœ€ä»»ä½•é…ç½®ï¼Œç›´æ¥è¿è¡Œå³å¯ï¼ˆä¸éœ€è¦ Cookieï¼‰ï¼š

```bash
docker run -d -p 8000:8000 --name douyin-phaser ghcr.io/yusongxiao/douyin_phaser:main
```
æœåŠ¡å¯åŠ¨åï¼Œè®¿é—® `http://localhost:8000` å³å¯ä½¿ç”¨ã€‚

### æ–¹å¼äºŒï¼šDocker Compose éƒ¨ç½² (æ¨è - å®Œæ•´åŠŸèƒ½)

è¿™ç§æ–¹å¼å¯ä»¥åŒæ—¶å¯åŠ¨åª’ä½“æå– API (8000) å’Œç”¨æˆ·ä¸»é¡µæå– API (8001)ï¼Œå¹¶ä¸”æ”¯æŒæŒä¹…åŒ– Cookieã€‚

1. **ç”Ÿæˆ Cookie (å¿…é¡»)**
   
   ç”±äºå®¹å™¨å†…æ— æ³•æ‰«ç ç™»å½•ï¼Œä½ éœ€è¦å…ˆåœ¨å®¿ä¸»æœºç”Ÿæˆ Cookie æ–‡ä»¶ï¼š
   ```bash
   # åœ¨é¡¹ç›®ç›®å½•ä¸‹è¿è¡Œï¼Œä¼šå¼¹å‡ºæµè§ˆå™¨è®©ä½ æ‰«ç 
   python douyin_user_phaser.py --login
   # æˆåŠŸåä¼šç”Ÿæˆ douyin_cookies.json æ–‡ä»¶
   ```

2. **å¯åŠ¨æœåŠ¡**

   ä½¿ç”¨ Docker Compose ä¸€é”®å¯åŠ¨ï¼š
   ```bash
   docker compose up -d
   ```

   æˆ–è€…ä½¿ç”¨ Docker å‘½ä»¤ç›´æ¥è¿è¡Œ (å¦‚æœä½ æ²¡æœ‰å®‰è£… Compose)ï¼š
   ```bash
   docker run -d \
     -p 8000:8000 \
     -p 8001:8001 \
     -v ${PWD}/douyin_cookies.json:/app/douyin_cookies.json \
     --name douyin-phaser \
     ghcr.io/yusongxiao/douyin_phaser:main \
     sh -c "uvicorn douyin_phaser_api:app --host 0.0.0.0 --port 8000 & uvicorn douyin_user_phaser_api:app --host 0.0.0.0 --port 8001 & wait"
   ```

### æ–¹å¼ä¸‰ï¼šæºç éƒ¨ç½²

#### 1. å®‰è£…ä¾èµ–

éœ€è¦ Python 3.8+ ç¯å¢ƒã€‚

```bash
# å®‰è£… Python ä¾èµ–
pip install -r requirements.txt

# å®‰è£…æµè§ˆå™¨å†…æ ¸ (Playwright éœ€è¦)
playwright install chromium
```

#### 2. å¯åŠ¨ API æœåŠ¡

å¯åŠ¨ API æœåŠ¡å™¨ï¼Œä¾›å…¶ä»–ç¨‹åºè°ƒç”¨ï¼š

```bash
python douyin_phaser_api.py
```
æœåŠ¡å™¨é»˜è®¤è¿è¡Œåœ¨ `http://localhost:8000`ã€‚

**API ä½¿ç”¨ç¤ºä¾‹**:

```bash
# æå–è§†é¢‘/å›¾æ–‡ç›´é“¾ (åª’ä½“æå– API)
curl "http://localhost:8000/?url=https://v.douyin.com/abc1234/"

# æå–ç”¨æˆ·ä¸»é¡µæ‰€æœ‰ä½œå“ (ç”¨æˆ·æå– API)
curl "http://localhost:8001/?url=https://www.douyin.com/user/..."
```

**API æ–‡æ¡£**:
æµè§ˆå™¨è®¿é—® `http://localhost:8000/docs` (åª’ä½“æå–) æˆ– `http://localhost:8001/docs` (ç”¨æˆ·æå–) æŸ¥çœ‹å®Œæ•´çš„äº¤äº’å¼ API æ–‡æ¡£ã€‚

#### 3. å‘½ä»¤è¡Œä½¿ç”¨ (CLI)

ä¹Ÿå¯ä»¥ç›´æ¥è¿è¡Œè„šæœ¬æå–å•ä¸ªé“¾æ¥ï¼š

```bash
python douyin_phaser.py "https://v.douyin.com/abc1234/"
```

## ğŸ› ï¸ API è¿”å›ç»“æ„

API è¿”å›ç»Ÿä¸€çš„ JSON ç»“æ„ï¼Œæ–¹ä¾¿è°ƒç”¨æ–¹å¤„ç†ã€‚

### 1. åª’ä½“æå– API (ç«¯å£ 8000)

ç”¨äºæå–å•ä¸ªè§†é¢‘ã€å›¾æ–‡æˆ–åŠ¨å›¾çš„ç›´é“¾ã€‚

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "title": "ä½œå“æ ‡é¢˜",
    "author": "ä½œè€…æ˜µç§°",
    "cover": "å°é¢å›¾URL",
    "type": "video | images",  // é¡¶å±‚ç±»å‹æç¤º
    "items": [
      // ç»Ÿä¸€ Items æ•°ç»„ï¼Œåªéœ€éå†æ­¤æ•°ç»„å³å¯
      {
        "type": "video",
        "video_url": "https://...",
        "cover_url": "https://..."
      },
      {
        "type": "image",
        "image_url": "https://..."
      },
      {
        "type": "animated_image",
        "image_url": "https://...webp",
        "video_url": "https://...mp4"
      }
    ]
  }
}
```

### 2. ç”¨æˆ·ä¸»é¡µæå– API (ç«¯å£ 8001)

ç”¨äºæå–ç”¨æˆ·ä¸»é¡µçš„æ‰€æœ‰ä½œå“é“¾æ¥ã€‚

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "user": {
      "nickname": "ç”¨æˆ·æ˜µç§°",
      "sec_uid": "MS4wLjABAAAA...",
      "uid": "123456789",
      "avatar": "https://...",
      "signature": "ç”¨æˆ·ç­¾å",
      "aweme_count": 8
    },
    "works_count": 30,
    "works": [
      {
        "aweme_id": "7606955181091438309",
        "type": "note",
        "desc": "ä½œå“æè¿°",
        "share_url": "https://www.douyin.com/note/7606955181091438309",
        "create_time": 1771132277
      },
      {
        "aweme_id": "7599252551926900837",
        "type": "video",
        "desc": "ä½œå“æè¿°",
        "share_url": "https://www.douyin.com/video/7599252551926900837",
        "create_time": 1769338866
      }
    ]
  }
}
```

## ğŸ“š æ›´å¤šæ–‡æ¡£

- [æŠ€æœ¯åŸç†ä¸æ¶æ„è¯¦è§£](./åŸç†.md)

